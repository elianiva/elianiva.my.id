---
import { getRaindrops } from "~/data/raindrop";
import MainLayout from "~/layouts/MainLayout.astro";
import BackButton from "../components/BackButton.astro";

export const prerender = false;

const raindrops = await getRaindrops();
---

<MainLayout seo={{ title: "Bookmarks" }}>
	<section class="mx-auto max-w-3xl px-4 py-10">
		<BackButton />
		<h1
			class="font-serif relative inline-block text-xl md:text-3xl font-bold text-pink-950 mt-4"
		>
			Bookmarks / Today I Learned
		</h1>
		<p class="text-sm md:text-base font-serif text-pink-950/70 pt-2 pb-4">
			Well, seems like you've found this not-so-secret page :) <br /><br />
			This is where I keep my bookmarks or things that I learned. It's meant to
			be a public archive of things that I find interesting and useful whether
			it be an article, random thoughts, videos, literally anything. I hope
			you find something useful here too! These are all coming from my
			<a class="text-pink-400" href="https://raindrop.io">Raindrop.io</a> collections.
		</p>
		<div
			class="py-4 border-t border-pink-300 border-dashed flex flex-col gap-2"
			role="region"
			aria-label="Bookmark collections"
		>
			{
				raindrops.map((d, index) => {
					return (
						<details 
							class="group"
							id={`collection-${index}`}
							aria-expanded="false"
						>
							<summary 
								class="cursor-pointer list-none outline-none focus:ring-2 focus:ring-pink-400 focus:ring-offset-2 rounded-sm"
								aria-controls={`collection-content-${index}`}
								aria-label={`Toggle ${d.title} collection (${d.items.length} items)`}
							>
								<div class="relative flex items-center min-h-10 px-2 leading-none bg-pink-300/30 hover:bg-pink-300/50 transition-colors duration-100 rounded-sm">
									<div class="absolute top-0 -left-5 w-4 h-4 bg-sky-300/50 rounded-sm" />
									<div class="absolute top-5 -left-5 w-4 h-4 bg-yellow-300/50 rounded-sm" />
									<div class="flex items-center justify-between w-full font-serif">
										<h2 class="text-base font-bold text-pink-950 flex-1">
											{d.title}
										</h2>
										<span class="text-xs font-mono text-pink-950/70">
											({d.items.length} items)
										</span>
									</div>
								</div>
							</summary>
							<div 
								id={`collection-content-${index}`}
								class="grid grid-cols-1 md:grid-cols-3 gap-2 mt-2"
								role="group"
								aria-label={`${d.title} bookmarks`}
							>
								{d.items.map((item, itemIndex) => (
									<article class="flex flex-col h-full border border-pink-200 border-dashed rounded-md">
										{item.cover !== ""
											? (
												<img
													class="object-cover rounded-tl-md rounded-tr-md aspect-video h-auto w-auto bg-pink-100 alt:text-sm alt:font-mono"
													src={item.cover}
													alt={`Cover image for ${item.title}`}
													loading="lazy"
												/>
											) : (
												<div class="rounded-tl-md rounded-tr-md aspect-video h-auto w-auto bg-pink-100" aria-hidden="true"></div>
											)}
										<div class="flex-1 relative flex flex-col gap-2 justify-between items-start p-2 rounded-bl-md rounded-br-md bg-pink-300/10">
											<h3 class="text-xs font-medium font-serif text-pink-950 text-ellipsis line-clamp-2">
												<a 
													href={item.url} 
													target="_blank" 
													rel="noopener noreferrer"
													class="text-pink-950 hover:text-pink-700 focus:outline-none focus:ring-2 focus:ring-pink-400 focus:ring-offset-1 rounded"
													aria-describedby={`item-${index}-${itemIndex}-domain`}
												>
													{item.title}
												</a>
											</h3>
											<span 
												id={`item-${index}-${itemIndex}-domain`}
												class="text-[0.625rem] font-mono px-2 py-0.5 rounded bg-yellow-300/20 text-sky-950"
											>
												{item.domain}
											</span>
										</div>
									</article>
								))}
							</div>
						</details>
					);
				})
			}
		</div>
	</section>
</MainLayout>

<style>
	/* Remove default details marker */
	details > summary::-webkit-details-marker,
	details > summary::marker {
		display: none;
	}
</style>
