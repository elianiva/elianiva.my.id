---
import { getRaindrops } from "~/data/raindrop";
import MainLayout from "~/layouts/MainLayout.astro";
import BackButton from "../components/BackButton.astro";

export const prerender = false;

const raindrops = await getRaindrops();
---

<MainLayout seo={{ title: "Bookmarks" }}>
	<section class="mx-auto max-w-3xl px-4 py-10">
		<BackButton />
		<h1
			class="font-display relative inline-block text-2xl md:text-4xl font-bold text-pink-950 mt-4 tracking-wide"
		>
			Bookmarks / Today I Learned
		</h1>
		<p class="text-sm md:text-base font-body text-pink-950/70 pt-3 pb-4">
			Well, seems like you've found this not-so-secret page :) <br /><br />
			This is where I keep my bookmarks or things that I learned. It's meant to
			be a public archive of things that I find interesting and useful whether
			it be an article, random thoughts, videos, literally anything. I hope
			you find something useful here too! These are all coming from my
			<a class="text-pink-500 hover:text-pink-700 border-b border-dashed border-pink-500" href="https://raindrop.io">Raindrop.io</a> collections.
		</p>
		<div
			class="py-4 border-t border-pink-200/50 flex flex-col gap-3"
			role="region"
			aria-label="Bookmark collections"
		>
			{
				raindrops.map((d, index) => {
					return (
						<details 
							class="group glass-card rounded-2xl overflow-hidden"
							id={`collection-${index}`}
							aria-expanded="false"
						>
							<summary 
								class="cursor-pointer list-none outline-none focus:ring-2 focus:ring-pink-400 focus:ring-offset-2 rounded-xl p-3"
								aria-controls={`collection-content-${index}`}
								aria-label={`Toggle ${d.title} collection (${d.items.length} items)`}
							>
								<div class="relative flex items-center min-h-10 px-3 leading-none bg-pink-100/50 hover:bg-pink-100/80 transition-colors duration-100 rounded-xl"
								>
									<div class="absolute -top-1 -left-2 w-4 h-4 bg-sky-300/60 rounded-lg" />
									<div class="absolute top-4 -left-2 w-4 h-4 bg-yellow-300/60 rounded-lg" />
									<div class="flex items-center justify-between w-full font-body"
									>
										<h2 class="text-base font-bold font-display text-pink-950 flex-1"
										>
											{d.title}
										</h2>
										<span class="text-xs font-mono text-pink-950/70 bg-white/50 px-2 py-1 rounded-full"
										>
											({d.items.length} items)
										</span>
									</div>
								</div>
							</summary>
							<div 
								id={`collection-content-${index}`}
								class="grid grid-cols-1 md:grid-cols-3 gap-3 mt-2 p-3"
								role="group"
								aria-label={`${d.title} bookmarks`}
							>
								{d.items.map((item, itemIndex) => (
									<article class="flex flex-col h-full glass-card rounded-xl overflow-hidden transition-all duration-300 hover:-translate-y-1 hover:shadow-md">
										{item.cover !== ""
											? (
												<img
													class="object-cover rounded-t-xl aspect-video h-auto w-auto bg-pink-100"
													src={item.cover}
													alt={`Cover image for ${item.title}`}
													loading="lazy"
												/>
											) : (
												<div class="rounded-t-xl aspect-video h-auto w-auto bg-pink-100" aria-hidden="true"></div>
											)}
										<div class="flex-1 relative flex flex-col gap-2 justify-between items-start p-3 rounded-b-xl bg-white/40"
										>
											<h3 class="text-xs font-medium font-body text-pink-950 text-ellipsis line-clamp-2"
											>
												<a 
													href={item.link} 
													target="_blank" 
													rel="noopener noreferrer"
													class="text-pink-950 hover:text-pink-700 focus:outline-none focus:ring-2 focus:ring-pink-400 focus:ring-offset-1 rounded"
													aria-describedby={`item-${index}-${itemIndex}-domain`}
												>
													{item.title}
												</a>
											</h3>
											<span 
												id={`item-${index}-${itemIndex}-domain`}
												class="text-[0.625rem] font-mono px-2 py-0.5 rounded-full bg-yellow-200/40 text-pink-900"
											>
												{item.domain}
											</span>
										</div>
									</article>
								))}
							</div>
						</details>
					);
				})
			}
		</div>
	</section>
</MainLayout>

<style>
	/* Remove default details marker */
	details > summary::-webkit-details-marker,
	details > summary::marker {
		display: none;
	}
</style>
