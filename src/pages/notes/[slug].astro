---
import { getEntry, render } from "astro:content";
import Backlinks from "~/components/notes/Backlinks.astro";
import MainLayout from "~/layouts/MainLayout.astro";
export const prerender = false;
const { slug } = Astro.params;
const note = await getEntry("notes", slug);
if (!note) {
	return Astro.redirect("/404");
}
const { Content } = await render(note);

const { title, category, tags, created_at, modified_at, backlinks } = note.data;

const categoryLabels: Record<string, string> = {
	article: "Article",
	vault: "Vault",
	person: "Person",
	music: "Music",
};

const displayTags = tags.filter((t) => t !== "public");

const createdDate = new Date(created_at).toLocaleDateString("en-US", {
	year: "numeric",
	month: "long",
	day: "numeric",
});

const modifiedDate = new Date(modified_at).toLocaleDateString("en-US", {
	year: "numeric",
	month: "long",
	day: "numeric",
});
---

<MainLayout seo={{ title: title }}>
	<article class="mx-auto max-w-3xl px-4 py-10">
		{/* Breadcrumb */}
		<nav class="text-sm text-pink-950/50 mb-6">
			<a href="/notes" class="hover:text-pink-700 transition-colors">Notes</a>
			<span class="mx-2">/</span>
			<span>{categoryLabels[category]}</span>
		</nav>

		{/* Header */}
		<header class="mb-8">
			<h1 class="font-display text-3xl md:text-4xl font-bold text-pink-950 tracking-wide">
				{title}
			</h1>

			<div class="flex flex-wrap items-center gap-3 mt-4 text-sm text-pink-950/60">
				<span class="px-2 py-1 rounded-full bg-pink-100/50 text-pink-900 text-xs font-medium">
					{categoryLabels[category]}
				</span>
				<span>Created {createdDate}</span>
				{modified_at.getTime() !== created_at.getTime() && (
					<span>Â· Modified {modifiedDate}</span>
				)}
			</div>

			{displayTags.length > 0 && (
				<div class="flex flex-wrap gap-2 mt-4">
					{displayTags.map((tag) => (
						<span class="text-xs px-2 py-1 rounded-full bg-white/60 text-pink-950/70 border border-dashed border-pink-200">
							#{tag}
						</span>
					))}
				</div>
			)}
		</header>

		{/* Content */}
		<div class="prose prose-pink max-w-none">
			<Content />
		</div>

		{/* Backlinks */}
		{backlinks.length > 0 && <Backlinks note={note} />}
	</article>
</MainLayout>
